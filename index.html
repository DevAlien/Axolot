<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Axolot by DevAlien</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Axolot</h1>
        <p>API-driven realtime framework</p>
        <p class="view"><a href="https://github.com/DevAlien/Axolot">View the Project on GitHub <small>DevAlien/Axolot</small></a></p>
        <ul>
          <li><a href="https://github.com/DevAlien/Axolot/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/DevAlien/Axolot/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/DevAlien/Axolot">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h3>
<a id="axolot-another-nodejs-framework" class="anchor" href="#axolot-another-nodejs-framework" aria-hidden="true"><span class="octicon octicon-link"></span></a>Axolot (Another node.js framework?)</h3>

<p>I needed something similar to sails.js but that I could update, for example, socket.io and it was much simpler, without having everything out of the box. So I basically took out everything I liked about it and made a smaller version with some different features.</p>

<h3>
<a id="get-started" class="anchor" href="#get-started" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get Started</h3>

<p><a href="http://devalien.io/axolot-first-project/">Basic Tutorial</a></p>

<p>Axolot comes bundled with a command line tool which can be used to easily create a new project </p>

<pre><code>$ npm install axolot -g
$ axolot new demoproject
$ cd demoproject
</code></pre>

<p>Once you are in the folder of your project, you will have a simple structure</p>

<ul>
<li>api - Folder containing basically all your code (controllers, models, services, etc.)</li>
<li>config - Folder containing various configuration files</li>
<li>app.js - Your entry point</li>
</ul>

<p>To start the app you have 2 different ways use <code>gulp</code>, which is good in development since it will restart when you edit a file, or simply use <code>npm start</code></p>

<h3>
<a id="models" class="anchor" href="#models" aria-hidden="true"><span class="octicon octicon-link"></span></a>Models</h3>

<p>For the models I choose to use Waterline from the guys of sails.js I find it simple to use and it does the job.
Basically you can add a model inside the folder <code>api/models</code>.</p>

<p>Example <code>api/models/user.js</code></p>

<div class="highlight highlight-source-js"><pre>    <span class="pl-c1">module</span>.exports <span class="pl-k">=</span> {

        identity<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span>
        attributes<span class="pl-k">:</span> {
            username<span class="pl-k">:</span> { type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>string<span class="pl-pds">'</span></span>, required<span class="pl-k">:</span> <span class="pl-c1">true</span> },
            password<span class="pl-k">:</span> { type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>string<span class="pl-pds">'</span></span>, minLength<span class="pl-k">:</span> <span class="pl-c1">6</span>, required<span class="pl-k">:</span> <span class="pl-c1">true</span> },
            <span class="pl-c">// Lifecycle Callbacks</span>
            <span class="pl-en">beforeCreate</span><span class="pl-k">:</span> <span class="pl-k">function</span>(<span class="pl-smi">values</span>, <span class="pl-smi">next</span>) {
                bcrypt.<span class="pl-c1">hash</span>(values.password, <span class="pl-c1">10</span>, <span class="pl-k">function</span>(<span class="pl-smi">err</span>, <span class="pl-smi">hash</span>) {
                    <span class="pl-k">if</span>(err) <span class="pl-k">return</span> next(err);
                    values.password <span class="pl-k">=</span> hash;
                    next();
                });
            }
        }
    };</pre></div>

<p>If you don't know how Waterline works you can refer to their documentation: <a href="https://github.com/balderdashy/waterline-docs">https://github.com/balderdashy/waterline-docs</a></p>

<h3>
<a id="controllers" class="anchor" href="#controllers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Controllers</h3>

<p>Controllers is where you define your endpoints (routing). A Controller can be associated with a model, and in this way, the CRUD operations will be there automatically, but you can always override them. Controllers are stored in <code>api/controllers</code></p>

<p>Controllers can also have socket.io methods which are callable from socket.io-client with <code>controllername:method</code>`</p>

<p>Example <code>api/controllers/user.js</code></p>

<div class="highlight highlight-source-js"><pre>    <span class="pl-c1">module</span>.exports <span class="pl-k">=</span> {
        model<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>user<span class="pl-pds">'</span></span>, <span class="pl-c">// We are attaching the user to the model, so CRUD operations are there (good for dev purposes)</span>
        path<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>/user<span class="pl-pds">'</span></span>, <span class="pl-c">// Tthis is the end point</span>

        actions<span class="pl-k">:</span> {
            <span class="pl-s"><span class="pl-pds">'</span>get /<span class="pl-pds">'</span></span><span class="pl-k">:</span> [
                <span class="pl-k">function</span> (<span class="pl-smi">req</span>, <span class="pl-smi">res</span>) {
                    <span class="pl-k">var</span> query <span class="pl-k">=</span> {};

                    Model.user.<span class="pl-c1">find</span>(query).then(<span class="pl-k">function</span>(<span class="pl-smi">user</span>) { <span class="pl-c">// Find from the User Model declared above</span>
                        res.<span class="pl-c1">send</span>(user);
                    }).catch(<span class="pl-k">function</span> (<span class="pl-smi">err</span>){
                        res.<span class="pl-c1">send</span>(<span class="pl-c1">400</span>, err);
                    });
                }],
        },
        sockets<span class="pl-k">:</span> {
            <span class="pl-en">getSingle</span><span class="pl-k">:</span> <span class="pl-k">function</span>(<span class="pl-smi">userId</span>, <span class="pl-smi">cb</span>) { <span class="pl-c">// This one is callable from socket.io using "user:getSingle</span>
                Model.user.findOne(userId).then(<span class="pl-k">function</span>(<span class="pl-smi">user</span>) {
                    cb(user)
                }).catch(<span class="pl-k">function</span> (<span class="pl-smi">err</span>){
                    cb({error<span class="pl-k">:</span> err})
                });
            }
        }
    };</pre></div>

<h3>
<a id="services" class="anchor" href="#services" aria-hidden="true"><span class="octicon octicon-link"></span></a>Services</h3>

<p>Services are simply some support objects that can help us doing something. For example we could create a service to  send emails. Services are accessible globally through the variable <code>Service</code> and are stored in <code>api/services</code>.</p>

<p>Example <code>api/services/mailer.js</code> which will be callable from <code>Service.mailer.send</code></p>

<div class="highlight highlight-source-js"><pre>    <span class="pl-k">var</span> nodemailer <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>nodemailer<span class="pl-pds">'</span></span>);

    <span class="pl-c1">module</span>.exports <span class="pl-k">=</span> {

        <span class="pl-c">/**</span>
<span class="pl-c">         * Sends an email to a given recipient</span>
<span class="pl-c">         * <span class="pl-k">@method</span> send</span>
<span class="pl-c">         * <span class="pl-k">@param</span> {object}   email           an object containing all of the necessary data to email</span>
<span class="pl-c">         * <span class="pl-k">@param</span> {Function} cb[err, res]    the callback to call once email is sent, or if it fails</span>
<span class="pl-c">         * <span class="pl-k">@return</span></span>
<span class="pl-c">         */</span>
        <span class="pl-en">send</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">email</span>, <span class="pl-smi">cb</span>) {
            <span class="pl-k">var</span> config <span class="pl-k">=</span> <span class="pl-v">this</span>.config;
            <span class="pl-c">/** sets up the modemailer smtp transport */</span>
            <span class="pl-k">var</span> transport <span class="pl-k">=</span> nodemailer.createTransport(config.nodemailer.<span class="pl-c1">type</span>, {
                service<span class="pl-k">:</span> config.nodemailer.service,
                auth<span class="pl-k">:</span> {
                    user<span class="pl-k">:</span> config.nodemailer.user,
                    pass<span class="pl-k">:</span> config.nodemailer.pass
                }
            });

            <span class="pl-c">/** sets up the mail options, from and such like that **/</span>
            <span class="pl-k">var</span> <span class="pl-k">from</span> <span class="pl-k">=</span> email.from <span class="pl-k">||</span> <span class="pl-s"><span class="pl-pds">'</span>nobody@nobody.com<span class="pl-pds">'</span></span>;
            <span class="pl-k">var</span> subject;
            <span class="pl-k">if</span> (config.nodemailer.prependSubject) {
                subject <span class="pl-k">=</span> config.nodemailer.prependSubject <span class="pl-k">+</span> email.subject;
            } <span class="pl-k">else</span> {
                subject <span class="pl-k">=</span> email.subject;
            }

            <span class="pl-k">var</span> mailOptions <span class="pl-k">=</span> {
                from<span class="pl-k">:</span> email.<span class="pl-c1">name</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>&lt;<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-k">from</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>&gt;<span class="pl-pds">'</span></span>,
                to<span class="pl-k">:</span> email.to,
                subject<span class="pl-k">:</span> subject,
                html<span class="pl-k">:</span> email.messageHtml
            };

            <span class="pl-c">/** Actually sends the email */</span>
            transport.sendMail(mailOptions, <span class="pl-k">function</span> (<span class="pl-smi">err</span>, <span class="pl-smi">response</span>) {
                <span class="pl-k">if</span> (err) <span class="pl-k">return</span> cb(err);
                <span class="pl-k">return</span> cb(<span class="pl-c1">null</span>, response);
            });
        }
    };</pre></div>

<h3>
<a id="config" class="anchor" href="#config" aria-hidden="true"><span class="octicon octicon-link"></span></a>Config</h3>

<p>Configuration can be separated by environments</p>

<h3>
<a id="cli" class="anchor" href="#cli" aria-hidden="true"><span class="octicon octicon-link"></span></a>CLI</h3>

<p>With the CLI you can create new projects and you can access an interactive console, loading your code as well. This is good for testing something and/or debugging.</p>

<p>To generate a new project is pretty easy, after you created it you can mode into that folder (same name of the project) and start coding.</p>

<pre><code>$ axolot new projectName
</code></pre>

<p>To enter in the interactive console, you have to be in the folder of an axolot project. You can select the environment (which is basically the config filename).</p>

<pre><code>$ axolot console environment
</code></pre>

<p>More commands will comoe shortly.</p>

<h3>
<a id="support--contact" class="anchor" href="#support--contact" aria-hidden="true"><span class="octicon octicon-link"></span></a>Support &amp; Contact</h3>

<p>You can drop me an email at <a href="mailto:g@margalho.info">g@margalho.info</a> or ask a question in StackOverflow or simply open an issue on GitHub.com</p>

<p>More updats will come soon.</p>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/DevAlien">DevAlien</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-67500883-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
